name: Flatpak Build

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

permissions:
  contents: read

jobs:
  build-flatpak:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install flatpak and flatpak-builder
      run: |
        sudo apt-get update
        sudo apt-get install -y flatpak flatpak-builder

    - name: Add Flathub repository
      run: |
        sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

    - name: Install Flatpak SDK and runtime
      run: |
        sudo flatpak install -y flathub org.kde.Platform//6.10
        sudo flatpak install -y flathub org.kde.Sdk//6.10
        sudo flatpak install -y flathub com.riverbankcomputing.PyQt.BaseApp//6.10

    - name: Install just
      uses: extractions/setup-just@v2

    - name: Build Flatpak
      run: just build-flatpak
